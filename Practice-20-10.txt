-- 20/10/2022
-- use before insert trigger
SELECT * FROM EMPLOYEE;
DELIMITER $
CREATE TRIGGER PROPERSALARY
BEFORE INSERT ON EMPLOYEE FOR EACH ROW
BEGIN
IF NEW.SALARY < 0 THEN SET NEW.SALARY = 0;
END IF;
END$
DELIMITER ;
INSERT INTO EMPLOYEE VALUES(8865, 'ANUPAMA', 'SALESMAN', 8789, '2022-08-09', -4500.00, NULL, 10);



-- USE AFTER UPDTE TRIGGER ANOTHER EXAMPLE
CREATE TABLE TEACHER(NAME VARCHAR(20), DEPARTMENT VARCHAR(25), TID INT);
INSERT INTO TEACHER VALUES('PREETHI', 'COMPUTER', 1);
SELECT * FROM TEACHER;
CREATE TABLE UPDATEINFO(UPDATEDTID INT);
DELIMITER $
CREATE TRIGGER TRIGGERRR
AFTER UPDATE ON TEACHER FOR EACH ROW
BEGIN
INSERT INTO UPDATEINFO(UPDATEDTID) VALUES (NEW.TID);
END $
DELIMITER ;
UPDATE TEACHER SET TID = 2;


-- TRANSACTIONS
START TRANSACTION;
DELETE FROM EMPLOYEE WHERE SALARY = 6000;
COMMIT;
INSERT INTO EMPLOYEE VALUES(9998, 'PREETHI', 'SALESMAN', 8789, '2022-08-09', 4500.00, NULL, 1);
ROLLBACK;
SELECT  * FROM EMPLOYEE;


-- SAVEPOINT
START TRANSACTION;
SELECT * FROM EMPLOYEE;
UPDATE EMPLOYEE SET SALARY = SALARY +500;
SAVEPOINT ONE;
INSERT INTO EMPLOYEE VALUES(9998, 'JATIN', 'CLERK', 8789, '2022-08-09', 4500.00, NULL, 1);
ROLLBACK TO ONE;
COMMIT;


-- TRANSACTION FOR BANK

CREATE TABLE BANK(
BANK_NAME VARCHAR(20),
ACCOUNT_NO INT,
BALANCE INT
);

INSERT INTO BANK VALUES('CITY UNION', 5004444, 50000),
('BANK OF BODODA', 5005555, 60000),
('SBI', 5006666, 70000);
SELECT * FROM BANK;

START TRANSACTION;
SELECT * FROM BANK;
UPDATE BANK SET BALANCE = BALANCE + 600;
SAVEPOINT STOP;
INSERT INTO BANK VALUES('ICICI', 5007777, 30000); 
ROLLBACK TO STOP;
COMMIT;